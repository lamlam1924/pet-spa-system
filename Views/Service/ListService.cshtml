@model pet_spa_system1.ViewModels.ServiceViewModel
@{
    ViewData["Title"] = "Dịch Vụ Spa Thú Cưng";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var selectedCategoryId = Context.Request.Query["categoryId"].ToString();
    
    // Thiết lập các hình ảnh mặc định cho các dịch vụ
    var defaultImages = new string[] { 
        "/images/services/grooming.jpg", 
        "/images/services/bath.jpg", 
        "/images/services/nail.jpg", 
        "/images/services/healthcare.jpg",
        "/images/services/massage.jpg"
    };
}

@section Styles {
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="@Url.Content("~/cssjsAppointment/services-list.css")">
    <style>
        .opacity-0 { opacity: 0; }
        .fade-transition {
            transition: all 0.5s;
            opacity: 0.5;
        }
    </style>
}

<section class="services-section">
    <div class="container">
        <!-- Section Header -->
        <div class="section-header text-center">
            <h2 class="animate__animated animate__fadeInDown">Dịch Vụ Chăm Sóc Thú Cưng</h2>
            <p class="animate__animated animate__fadeInUp animate__delay-1s">
                Khám phá các dịch vụ chăm sóc thú cưng chuyên nghiệp và tận tâm tại Pet Spa, nơi thú cưng của bạn sẽ được chăm sóc như người thân yêu.
            </p>
        </div>
        
        <!-- Filter Section -->
        <div class="filter-section animate__animated animate__fadeIn animate__delay-1s">
            <div class="row align-items-center">
                <div class="col-md-4">
                    <form id="filter-form" method="get" class="d-flex align-items-center">
                        <span class="filter-label">Danh mục:</span>
                        <select id="category-filter" name="categoryId" class="category-select">
                            <option value="">Tất cả danh mục</option>
                            @foreach (var cat in Model.Categories)
                            {
                                if (selectedCategoryId == cat.CategoryId.ToString())
                                {
                                    <option value="@cat.CategoryId" selected="selected">@cat.Name</option>
                                }
                                else
                                {
                                    <option value="@cat.CategoryId">@cat.Name</option>
                                }
                            }
                        </select>
                    </form>
                </div>
                <div class="col-md-4">
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0">
                            <i class="fas fa-search text-muted"></i>
                        </span>
                        <input type="text" id="service-search" class="form-control border-start-0" placeholder="Tìm kiếm dịch vụ...">
                    </div>
                </div>
                <div class="col-md-4 text-end">
                    <div class="btn-group">
                        <button id="sort-price" class="btn btn-outline-secondary btn-sm asc">
                            <i class="fas fa-sort-amount-up"></i> Giá: Thấp đến cao
                        </button>
                        <button id="sort-duration" class="btn btn-outline-secondary btn-sm asc">
                            <i class="fas fa-sort-amount-up"></i> Thời lượng: Ngắn đến dài
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Loading Indicator -->
        <div id="service-loading" class="text-center py-5" style="display: none;">
            <div class="spinner-border text-primary">
                <span class="visually-hidden">Đang tải...</span>
            </div>
            <p class="mt-2">Đang tải dịch vụ...</p>
        </div>
        
        <!-- Services Cards -->
        <div class="row mt-4" id="service-container">
            @if (Model.Services != null && Model.Services.Any())
            {
                foreach (var item in Model.Services)
                {
                    var randomImg = defaultImages[new Random().Next(defaultImages.Length)];
                    
                    // Tạo badge ngẫu nhiên dựa vào giá và thời lượng
                    var badges = new string[] { "Hot", "Phổ biến", "Mới", "Khuyến mãi", "" };
                    var badgeIndex = (item.ServiceId + DateTime.Now.Day) % badges.Length;
                    var badgeText = badges[badgeIndex];
                    
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="service-card">
                            <div class="service-img">
                                <img src="@randomImg" alt="@item.Name">
                                @if (!string.IsNullOrEmpty(badgeText))
                                {
                                    <span class="service-badge">@badgeText</span>
                                }
                            </div>
                            <div class="service-body">
                                <h3 class="service-title">@item.Name</h3>
                                <p class="service-description">@item.Description</p>
                                <div class="service-meta">
                                    <div class="service-price" data-price="@item.Price">@item.Price.ToString("N0") đ</div>
                                    <div class="service-duration" data-duration="@item.DurationMinutes">
                                        <i class="far fa-clock"></i> @item.DurationMinutes phút
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="col-12 text-center py-5">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i> Không tìm thấy dịch vụ nào.
                    </div>
                </div>
            }
        </div>
        
        <!-- No Results Message -->
        <div id="no-results" class="text-center py-4 mt-3" style="display: none;">
            <div class="alert alert-info">
                <i class="fas fa-search me-2"></i> Không tìm thấy dịch vụ nào phù hợp với tìm kiếm của bạn.
            </div>
        </div>
        
        <!-- Call to Action -->
        <div class="text-center mt-5 animate__animated animate__fadeInUp">
            <p class="mb-4">Bạn đã tìm thấy dịch vụ phù hợp cho thú cưng của mình?</p>
            <a href="@Url.Action("Index", "Appointment")" class="btn btn-primary btn-lg">
                <i class="far fa-calendar-check me-2"></i> Đặt Lịch Ngay
            </a>
        </div>
    </div>
</section>

@section Scripts {
    <script src="@Url.Content("~/cssjsAppointment/services-list.js")"></script>
}