@model pet_spa_system1.ViewModel.BlogCreateViewModel
@{
    ViewData["Title"] = "Chỉnh sửa bài viết";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <!-- Summernote CSS -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.css" rel="stylesheet">
    <style>
        /* Copy toàn bộ CSS phần Styles từ Create.cshtml nếu cần */
        .blog-create-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        /* Các style tương tự như phần Create.cshtml để giao diện giống hoàn toàn */
    </style>
}

<div class="bradcam_area breadcam_bg">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="bradcam_text text-center">
                    <h3>Chỉnh sửa bài viết</h3>
                    <p>Cập nhật nội dung và hình ảnh blog</p>
                </div>
            </div>
        </div>
    </div>
</div>

<section class="blog-create-section section-padding">
    <div class="container">
        <div class="blog-create-container">
            <form asp-action="Edit" method="post" enctype="multipart/form-data" id="blogForm">
                @Html.AntiForgeryToken()
                <input type="hidden" asp-for="BlogId" value="@ViewBag.BlogId" />

                <!-- Title -->
                <div class="form-section">
                    <h4 class="section-title"><i class="fas fa-edit"></i> Thông Tin Cơ Bản</h4>
                    <div class="form-group">
                        <label asp-for="Title" class="form-label">Tiêu đề *</label>
                        <input asp-for="Title" class="form-control" />
                        <span asp-validation-for="Title" class="text-danger"></span>
                    </div>

                    <div class="form-group">
                        <label asp-for="Category" class="form-label">Danh mục</label>
                        <select asp-for="Category" class="form-control" asp-items="ViewBag.AvailableCategories as IEnumerable<SelectListItem>">
                            <option value="">-- Chọn danh mục --</option>
                        </select>
                    </div>
                </div>

                <!-- Content -->
                <div class="form-section">
                    <h4 class="section-title"><i class="fas fa-align-left"></i> Nội Dung Bài Viết</h4>
                    <div class="form-group">
                        <label asp-for="Content" class="form-label">Nội dung *</label>
                        <textarea asp-for="Content" id="contentEditor" class="form-control" rows="15"></textarea>
                        <span asp-validation-for="Content" class="text-danger"></span>
                    </div>
                </div>

                <!-- Featured Image -->
                <div class="form-section">
                    <h4 class="section-title"><i class="fas fa-image"></i> Hình ảnh nổi bật</h4>
                    <div class="form-group">
                        <input asp-for="FeaturedImage" type="file" class="form-control" accept="image/*" />
                        <span asp-validation-for="FeaturedImageUrl" class="text-danger"></span>
                        @if (!string.IsNullOrEmpty(Model.FeaturedImageUrl))
                        {
                            <img src="@Model.FeaturedImageUrl" alt="Hình hiện tại" style="max-width: 300px; margin-top: 10px;" />
                        }
                    </div>
                </div>

                <!-- Status -->
                <div class="form-section">
                    <h4 class="section-title"><i class="fas fa-cog"></i> Trạng Thái</h4>
                    <div class="form-group">
                        <select asp-for="Status" class="form-control">
                            <option value="PendingApproval">Chờ duyệt</option>
                            <option value="Published">Đã xuất bản</option>
                            <option value="Rejected">Đã từ chối</option>
                        </select>
                        <span asp-validation-for="Status" class="text-danger"></span>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="form-section">
                    <div class="action-buttons">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Lưu thay đổi
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</section>

@section Scripts {
    <!-- Summernote JS -->
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/lang/summernote-vi-VN.min.js"></script>

    <script>
        $(document).ready(function () {
            $('#contentEditor').summernote({
                height: 400,
                lang: 'vi-VN',
                toolbar: [
                    ['style', ['style']],
                    ['font', ['bold', 'italic', 'underline', 'clear']],
                    ['fontname', ['fontname']],
                    ['fontsize', ['fontsize']],
                    ['color', ['color']],
                    ['para', ['ul', 'ol', 'paragraph']],
                    ['table', ['table']],
                    ['insert', ['link', 'picture', 'video']],
                    ['view', ['fullscreen', 'codeview', 'help']]
                ],
                callbacks: {
                    onImageUpload: function (files) {
                        for (let i = 0; i < files.length; i++) {
                            uploadImageToEditor(files[i]);
                        }
                    },
                    onChange: function (contents, $editable) {
                        $('#Content').val(contents);
                    }
                }
            });

            // Gán lại nội dung nếu cần
            var currentContent = $('#Content').val();
            $('#contentEditor').summernote('code', currentContent);
        });

        function uploadImageToEditor(file) {
            if (!file.type.match('image.*')) {
                alert('Chỉ cho phép hình ảnh');
                return;
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                $('#contentEditor').summernote('insertImage', e.target.result);
            };
            reader.readAsDataURL(file);
        }
    </script>

    <partial name="_ValidationScriptsPartial" />
}
