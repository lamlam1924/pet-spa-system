@model pet_spa_system1.ViewModel.UserDetailViewModel
@{
    ViewData["Title"] = "Chi tiết khách hàng";
    Layout = "~/Views/Admin/_LayoutAdmin.cshtml";
}

<!-- Thêm SweetAlert2 CSS và JS nếu chưa có -->
<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="container-fluid py-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <!-- Xử lý hiển thị thông báo thành công bằng SweetAlert2 thay vì alert Bootstrap -->
            @if (TempData["SuccessMessage"] != null)
            {
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        Swal.fire({
                            icon: 'success',
                            title: '@TempData["SuccessMessage"]',
                            toast: true,
                            position: 'top-end',
                            showConfirmButton: false,
                            timer: 3000,
                            timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.addEventListener('mouseenter', Swal.stopTimer)
                                toast.addEventListener('mouseleave', Swal.resumeTimer)
                            }
                        });
                    });
                </script>
            }

            @if (TempData["ErrorMessage"] != null)
            {
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        Swal.fire({
                            icon: 'error',
                            title: 'Lỗi',
                            text: '@TempData["ErrorMessage"]',
                            toast: true,
                            position: 'top-end',
                            showConfirmButton: false,
                            timer: 3000
                        });
                    });
                </script>
            }
            
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 text-dark mb-1">Chi tiết khách hàng</h1>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb small mb-0">
                            <li class="breadcrumb-item">
                                <a href="@Url.Action("List_Customer", "User")" class="text-decoration-none">
                                    <i class="fas fa-users me-1"></i>Danh sách khách hàng
                                </a>
                            </li>
                            <li class="breadcrumb-item active">Chi tiết</li>
                        </ol>
                    </nav>
                </div>
                <div>
                    <a href="/Admin/List_Customer" class="btn btn-outline-secondary">
                        <i class="fas fa-arrow-left me-2"></i>Quay lại
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Left Sidebar: Customer Info & Stats -->
        <div class="col-xl-3 col-lg-4 mb-4">
            <!-- Customer Profile Card -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body">
                    <form asp-action="UserDetail" asp-controller="User" asp-route-id="@Model.User.UserId" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="UserId" value="@Model.User.UserId" />
                        
                        <!-- Avatar Section -->
                        <div class="text-center mb-4">
                            <div class="position-relative d-inline-block">
                                <img src="@(string.IsNullOrEmpty(Model.User.ProfilePictureUrl) ? "/imgAdmin/avatar-default.png" : Model.User.ProfilePictureUrl)" 
                                     alt="Avatar khách hàng" 
                                     class="rounded-circle shadow-sm border border-light" 
                                     style="width: 120px; height: 120px; object-fit: cover;" />
                                <label for="avatarInput" class="position-absolute bottom-0 end-0 bg-primary rounded-circle p-2 shadow-sm" style="cursor:pointer;">
                                    <i class="fas fa-camera text-white"></i>
                                    <input type="file" id="avatarInput" name="AvatarFile" class="d-none" onchange="this.form.submit()" />
                                </label>
                            </div>
                        </div>

                        <!-- Customer Info Form -->
                        <div class="mb-3">
                            <label class="form-label small text-muted">Họ và tên</label>
                            <input type="text" name="FullName" value="@Model.User.FullName" class="form-control" placeholder="Nhập họ tên" />
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label small text-muted">Email</label>
                            <input type="email" name="Email" value="@Model.User.Email" class="form-control" placeholder="Nhập email" />
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label small text-muted">Số điện thoại</label>
                            <input type="text" name="Phone" value="@Model.User.Phone" class="form-control" placeholder="Nhập số điện thoại" />
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label small text-muted">Địa chỉ</label>
                            <textarea name="Address" class="form-control" rows="2" placeholder="Nhập địa chỉ">@Model.User.Address</textarea>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-save me-2"></i>Lưu thay đổi
                        </button>
                    </form>
                </div>
            </div>

            <!-- Statistics Card -->
            <div class="card shadow-sm border-0">
                <div class="card-header bg-light">
                    <h6 class="card-title mb-0 text-primary fw-bold">
                        <i class="fas fa-chart-pie me-2"></i>Thống kê tổng quan
                    </h6>
                </div>
                <div class="card-body p-0">
                    <div class="row g-0">
                        <div class="col-6">
                            <div class="p-3 text-center border-end border-bottom">
                                <div class="h4 mb-1 text-primary">@Model.Pets?.Count()</div>
                                <div class="small text-muted">Thú cưng</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 text-center border-bottom">
                                <div class="h4 mb-1 text-success">@Model.Appointments?.Count()</div>
                                <div class="small text-muted">Lịch hẹn</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 text-center border-end">
                                <div class="h4 mb-1 text-warning">@Model.Orders?.Count()</div>
                                <div class="small text-muted">Đơn hàng</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="p-3 text-center">
                                <div class="h4 mb-1 text-info">@Model.Reviews?.Count()</div>
                                <div class="small text-muted">Đánh giá</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Content Area -->
        <div class="col-xl-9 col-lg-8">
            <!-- Tab Navigation -->
            <ul class="nav nav-tabs nav-justified mb-4" id="customerTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active d-flex align-items-center justify-content-center" id="pets-tab" data-bs-toggle="tab" data-bs-target="#pets" type="button" role="tab">
                        <i class="fas fa-paw fa-lg me-2 text-primary"></i>
                        <span class="fw-medium">Thú cưng</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link d-flex align-items-center justify-content-center" id="appointments-tab" data-bs-toggle="tab" data-bs-target="#appointments" type="button" role="tab">
                        <i class="fas fa-calendar-alt fa-lg me-2 text-success"></i>
                        <span class="fw-medium">Lịch hẹn</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link d-flex align-items-center justify-content-center" id="orders-tab" data-bs-toggle="tab" data-bs-target="#orders" type="button" role="tab">
                        <i class="fas fa-shopping-cart fa-lg me-2 text-warning"></i>
                        <span class="fw-medium">Đơn hàng</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link d-flex align-items-center justify-content-center" id="reviews-tab" data-bs-toggle="tab" data-bs-target="#reviews" type="button" role="tab">
                        <i class="fas fa-star fa-lg me-2 text-info"></i>
                        <span class="fw-medium">Đánh giá</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link d-flex align-items-center justify-content-center" id="payments-tab" data-bs-toggle="tab" data-bs-target="#payments" type="button" role="tab">
                        <i class="fas fa-credit-card fa-lg me-2 text-danger"></i>
                        <span class="fw-medium">Thanh toán</span>
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="customerTabsContent">
                <!-- Pets Tab -->
                <div class="tab-pane fade show active" id="pets" role="tabpanel" aria-labelledby="pets-tab">
                    <div class="card shadow-sm border-0">
                        <div class="card-header bg-gradient-light d-flex justify-content-between align-items-center py-3">
                            <h6 class="mb-0 d-flex align-items-center">
                                <i class="fas fa-paw text-primary me-2"></i> Danh sách thú cưng
                            </h6>
                            <span class="badge bg-primary rounded-pill px-3 py-2">@Model.Pets?.Count() thú cưng</span>
                        </div>
                        <div class="card-body p-0">
                            @if (Model.Pets != null && Model.Pets.Any())
                            {
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th class="border-0">Tên thú cưng</th>
                                                <th class="border-0">Loài</th>
                                                <th class="border-0">Giống</th>
                                                <th class="border-0">Tuổi</th>
                                                <th class="border-0">Ghi chú</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var pet in Model.Pets)
                                            {
                                                <tr>
                                                    <td><strong>@pet.Name</strong></td>
                                                    <td>@pet.SpeciesId</td>
                                                    <td>@pet.Breed</td>
                                                    <td>@pet.Age tuổi</td>
                                                    <td>@pet.SpecialNotes</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            }
                            else
                            {
                                <div class="p-4 text-center text-muted">
                                    <i class="fas fa-dog fa-3x mb-3 text-muted"></i>
                                    <p>Chưa có thú cưng nào được đăng ký</p>
                                </div>
                            }
                        </div>
                    </div>
                </div>

                <!-- Appointments Tab -->
                <div class="tab-pane fade" id="appointments" role="tabpanel" aria-labelledby="appointments-tab">
                    <div class="card shadow-sm border-0">
                        <div class="card-header bg-gradient-light d-flex justify-content-between align-items-center py-3">
                            <h6 class="mb-0 d-flex align-items-center">
                                <i class="fas fa-calendar-check text-success me-2"></i> Lịch sử lịch hẹn
                            </h6>
                            <span class="badge bg-success rounded-pill px-3 py-2">@Model.Appointments?.Count() lịch hẹn</span>
                        </div>
                        <div class="card-body p-0">
                            @if (Model.Appointments != null && Model.Appointments.Any())
                            {
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th class="border-0">Ngày & Giờ</th>
                                                <th class="border-0">Trạng thái</th>
                                                <th class="border-0">Ghi chú</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var appt in Model.Appointments)
                                            {
                                                <tr>
                                                    <td>
                                                        <div class="d-flex align-items-center">
                                                            <i class="fas fa-calendar-day me-2 text-primary"></i>
                                                            @appt.AppointmentDate.ToString("dd/MM/yyyy HH:mm")
                                                        </div>
                                                    </td>
                                                    <td>
                                                        @{
                                                            var statusName = appt.Status?.StatusName ?? "Không rõ";
                                                            var statusColor = "bg-light text-dark";
                                                            switch (statusName)
                                                            {
                                                                case "Chờ xác nhận":
                                                                case "Pending":
                                                                    statusColor = "bg-warning text-dark";
                                                                    break;
                                                                case "Đã xác nhận":
                                                                case "Confirmed":
                                                                    statusColor = "bg-success";
                                                                    break;
                                                                case "Đã hủy":
                                                                case "Cancelled":
                                                                    statusColor = "bg-danger";
                                                                    break;
                                                                case "Hoàn thành":
                                                                case "Completed":
                                                                    statusColor = "bg-primary";
                                                                    break;
                                                                case "Đang xử lý":
                                                                case "Processing":
                                                                    statusColor = "bg-info text-dark";
                                                                    break;
                                                                default:
                                                                    statusColor = "bg-light text-dark";
                                                                    break;
                                                            }
                                                        }
                                                        <span class="badge @statusColor">@statusName</span>
                                                    </td>
                                                    <td>@appt.Notes</td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            }
                            else
                            {
                                <div class="p-4 text-center text-muted">
                                    <i class="fas fa-calendar-times fa-3x mb-3 text-muted"></i>
                                    <p>Chưa có lịch hẹn nào</p>
                                </div>
                            }
                        </div>
                    </div>
                </div>

                <!-- Orders Tab -->
                <div class="tab-pane fade" id="orders" role="tabpanel" aria-labelledby="orders-tab">
                    <div class="card shadow-sm border-0">
                        <div class="card-header bg-gradient-light d-flex justify-content-between align-items-center py-3">
                            <h6 class="mb-0 d-flex align-items-center">
                                <i class="fas fa-shopping-bag text-warning me-2"></i> Lịch sử đơn hàng
                            </h6>
                            <span class="badge bg-warning rounded-pill px-3 py-2">@Model.Orders?.Count() đơn hàng</span>
                        </div>
                        <div class="card-body p-0">
                            @if (Model.Orders != null && Model.Orders.Any())
                            {
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th class="border-0">Ngày đặt</th>
                                                <th class="border-0">Tổng tiền</th>
                                                <th class="border-0">Trạng thái</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var order in Model.Orders)
                                            {
                                                <tr>
                                                    <td>
                                                        <div class="d-flex align-items-center">
                                                            <i class="fas fa-shopping-bag me-2 text-warning"></i>
                                                            @(order.OrderDate.HasValue ? order.OrderDate.Value.ToString("dd/MM/yyyy HH:mm") : "")
                                                        </div>
                                                    </td>
                                                    <td><strong class="text-success">@order.TotalAmount.ToString("N0") đ</strong></td>
                                                    <td>
                                                        @{
                                                            var orderStatusClass = "bg-secondary";
                                                            var orderStatusName = "Chưa xác định";
                                                            var orderStatusId = order.StatusId;
                                                            
                                                            switch (orderStatusId)
                                                            {
                                                                case 1:
                                                                    orderStatusClass = "bg-warning text-dark";
                                                                    orderStatusName = "Đang chờ xử lý";
                                                                    break;
                                                                case 2:
                                                                    orderStatusClass = "bg-info text-white";
                                                                    orderStatusName = "Đang chuẩn bị";
                                                                    break;
                                                                case 3:
                                                                    orderStatusClass = "bg-primary";
                                                                    orderStatusName = "Đã giao vận chuyển";
                                                                    break;
                                                                case 4:
                                                                    orderStatusClass = "bg-success";
                                                                    orderStatusName = "Đã giao";
                                                                    break;
                                                                case 5:
                                                                    orderStatusClass = "bg-danger";
                                                                    orderStatusName = "Đã hủy";
                                                                    break;
                                                            }
                                                        }
                                                        <span class="badge @orderStatusClass px-3 py-2">@orderStatusName</span>
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            }
                            else
                            {
                                <div class="p-4 text-center text-muted">
                                    <i class="fas fa-shopping-cart fa-3x mb-3 text-muted"></i>
                                    <p>Chưa có đơn hàng nào</p>
                                </div>
                            }
                        </div>
                    </div>
                </div>

                <!-- Reviews Tab -->
                <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                    <div class="card shadow-sm border-0">
                        <div class="card-header bg-gradient-light d-flex justify-content-between align-items-center py-3">
                            <h6 class="mb-0 d-flex align-items-center">
                                <i class="fas fa-star text-info me-2"></i> Đánh giá của khách hàng
                            </h6>
                            <span class="badge bg-info rounded-pill px-3 py-2">@Model.Reviews?.Count() đánh giá</span>
                        </div>
                        <div class="card-body p-0">
                            @if (Model.Reviews != null && Model.Reviews.Any())
                            {
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th class="border-0">Đối tượng</th>
                                                <th class="border-0">Điểm số</th>
                                                <th class="border-0">Bình luận</th>
                                                <th class="border-0">Ngày đánh giá</th>
                                <th class="border-0">Phản hồi</th>
                                <th class="border-0">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var review in Model.Reviews.Where(r => r.ParentReviewId == null))
                            {
                                <tr>
                                    <td>
                                        @if (review.ProductId != null)
                                        {
                                            <span class="badge bg-primary">
                                                <i class="fas fa-box me-1"></i>Sản phẩm: @review.ProductId
                                            </span>
                                        }
                                        else if (review.ServiceId != null)
                                        {
                                            <span class="badge bg-success">
                                                <i class="fas fa-spa me-1"></i>Dịch vụ: @review.ServiceId
                                            </span>
                                        }
                                    </td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <span class="me-2">@review.Rating</span>
                                            <div class="text-warning">
                                                @for (int i = 1; i <= 5; i++)
                                                {
                                                    <i class="fas @(i <= review.Rating ? "fa-star" : "fa-star-o")"></i>
                                                }
                                            </div>
                                        </div>
                                    </td>
                                    <td>@review.Comment</td>
                                    <td>@(review.CreatedAt.HasValue ? review.CreatedAt.Value.ToString("dd/MM/yyyy") : "")</td>
                                    <td>
                                        @{
                                            var replies = Model.Reviews.Where(r => r.ParentReviewId == review.ReviewId).ToList();
                                        }
                                        
                                        @if(replies != null && replies.Any())
                                        {
                                            <div class="accordion accordion-flush" id="replyAccordion-@review.ReviewId">
                                                <div class="accordion-item border-0">
                                                    <h2 class="accordion-header" id="replyHeading-@review.ReviewId">
                                                        <button class="btn btn-sm btn-outline-info" type="button" 
                                                                data-bs-toggle="collapse" data-bs-target="#replyCollapse-@review.ReviewId">
                                                            <i class="fas fa-comments me-1"></i> Xem (@replies.Count) phản hồi
                                                        </button>
                                                    </h2>
                                                    <div id="replyCollapse-@review.ReviewId" class="accordion-collapse collapse"
                                                         aria-labelledby="replyHeading-@review.ReviewId">
                                                        <div class="accordion-body p-0 mt-2">
                                                            @foreach (var reply in replies)
                                                            {
                                                                <div class="border-start ps-3 py-2 mb-2 review-reply">
                                                                    <div class="d-flex justify-content-between align-items-center">
                                                                        <span class="fw-bold small">
                                                                            @if(reply.Comment != null && reply.Comment.StartsWith("[SYSTEM_REPLY]"))
                                                                            {
                                                                                <span>Chăm sóc khách hàng <i class="fas fa-headset ms-1 text-primary"></i></span>
                                                                            }
                                                                            else
                                                                            {
                                                                                @(reply.User?.FullName ?? reply.User?.Username ?? "Admin")
                                                                                @if(reply.User?.RoleId == 1)
                                                                                {
                                                                                    <span class="badge bg-primary ms-1">Admin</span>
                                                                                }
                                                                            }
                                                                        </span>
                                                                        <small class="text-muted">@(reply.CreatedAt?.ToString("dd/MM/yyyy") ?? "")</small>
                                                                    </div>
                                                                    <p class="mb-0 small">
                                                                        @if(reply.Comment != null && reply.Comment.StartsWith("[SYSTEM_REPLY]"))
                                                                        {
                                                                            @reply.Comment.Substring("[SYSTEM_REPLY] ".Length)
                                                                        }
                                                                        else
                                                                        {
                                                                            @reply.Comment
                                                                        }
                                                                    </p>
                                                                </div>
                                                            }
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                        else if (review.Rating == 1)
                                        {
                                            <span class="text-danger"><i class="fas fa-exclamation-circle me-1"></i>Cần phản hồi</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">-</span>
                                        }
                                    </td>
                                    <td>
                                        @if((replies == null || !replies.Any()))
                                        {
                                            <button type="button" class="btn btn-sm btn-outline-primary" 
                                                    data-bs-toggle="modal" data-bs-target="#replyModal-@review.ReviewId">
                                                <i class="fas fa-reply me-1"></i> Phản hồi
                                            </button>
                                            
                                            <!-- Modal phản hồi -->
                                            <div class="modal fade" id="replyModal-@review.ReviewId" tabindex="-1">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title">Phản hồi đánh giá</h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <form action="/Products/AddReply" method="post">
                                                            <div class="modal-body">
                                                                <input type="hidden" name="parentReviewId" value="@review.ReviewId" />
                                                                <input type="hidden" name="returnUrl" value="@Context.Request.Path@Context.Request.QueryString" />
                                                                <div class="mb-3">
                                                                    <label class="form-label">Đánh giá của khách hàng:</label>
                                                                    <div class="p-3 bg-light rounded">@review.Comment</div>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label for="content-@review.ReviewId" class="form-label">Nội dung phản hồi:</label>
                                                                    <textarea id="content-@review.ReviewId" name="content" class="form-control" rows="3" required></textarea>
                                                                </div>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                                                                <button type="submit" class="btn btn-primary">Gửi phản hồi</button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="p-4 text-center text-muted">
                    <i class="fas fa-star fa-3x mb-3 text-muted"></i>
                    <p>Chưa có đánh giá nào</p>
                </div>
            }
        </div>
    </div>
</div>

                <!-- Payments Tab -->
                <div class="tab-pane fade" id="payments" role="tabpanel" aria-labelledby="payments-tab">
                    <div class="card shadow-sm border-0">
                        <div class="card-header bg-gradient-light d-flex justify-content-between align-items-center py-3">
                            <h6 class="mb-0 d-flex align-items-center">
                                <i class="fas fa-money-check-alt text-danger me-2"></i> Lịch sử thanh toán
                            </h6>
                            <span class="badge bg-danger rounded-pill px-3 py-2">@Model.Payments?.Count() thanh toán</span>
                        </div>
                        <div class="card-body p-0">
                            @if (Model.Payments != null && Model.Payments.Any())
                            {
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th class="border-0">Ngày thanh toán</th>
                                                <th class="border-0">Số tiền</th>
                                                <th class="border-0">Phương thức</th>
                                                <th class="border-0">Trạng thái</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var pay in Model.Payments)
                                            {
                                                <tr>
                                                    <td>
                                                        <div class="d-flex align-items-center">
                                                            <i class="fas fa-money-bill-wave me-2 text-success"></i>
                                                            @(pay.PaymentDate.HasValue ? pay.PaymentDate.Value.ToString("dd/MM/yyyy HH:mm") : "")
                                                        </div>
                                                    </td>
                                                    <td><strong class="text-success">@pay.Amount.ToString("N0") đ</strong></td>
                                                    <td>
                                                        <span class="badge bg-outline-primary">@pay.PaymentMethodId</span>
                                                    </td>
                                                    <td>
                                                        <span class="badge bg-success">@pay.PaymentStatusId</span>
                                                    </td>
                                                </tr>
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            }
                            else
                            {
                                <div class="p-4 text-center text-muted">
                                    <i class="fas fa-credit-card fa-3x mb-3 text-muted"></i>
                                    <p>Chưa có giao dịch thanh toán nào</p>
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Màu sắc tùy chỉnh */
.bg-primary {
    color: white;
    background-color: #6777ef !important;
}

.bg-warning {
    color: #212529;
    background-color: #ffa426 !important;
}

.bg-success {
    color: white;
    background-color: #63ed7a !important;
}

.bg-info {
    color: white;
    background-color: #3abaf4 !important;
}

.bg-danger {
    color: white;
    background-color: #fc544b !important;
}

/* Loại bỏ gradient tối màu */
.bg-gradient-primary {
    background: #f8f9fa;
    color: #0d6efd;
}

.bg-gradient-light {
    background: linear-gradient(to right, #f8f9fa, #ffffff);
}

.nav-tabs .nav-link {
    border: none;
    border-radius: 0.5rem 0.5rem 0 0;
    padding: 0.75rem 1.25rem;
    font-weight: 500;
    transition: all 0.2s ease;
    color: #495057;
}

.nav-tabs .nav-link:hover {
    background-color: rgba(13, 110, 253, 0.1);
    border-color: transparent;
    color: #0d6efd;
}

.nav-tabs .nav-link.active {
    background-color: #fff;
    color: #0d6efd;
    border-bottom: 3px solid #0d6efd;
    font-weight: 600;
}

.card {
    border-radius: 0.75rem;
    overflow: hidden;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    border: none;
}

.card-header {
    background-color: #f8f9fa;
    padding: 1rem 1.25rem;
    border-bottom: 1px solid rgba(0,0,0,0.05);
}

.table th {
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 0.03em;
    color: #6c757d;
}

.table td {
    vertical-align: middle;
    padding: 0.75rem 1rem;
}

.badge {
    font-weight: 600;
    letter-spacing: 0.03em;
    padding: 0.5em 0.75em;
}

.btn {
    border-radius: 0.5rem;
    font-weight: 500;
    padding: 0.375rem 0.75rem;
}

.form-control {
    border-radius: 0.5rem;
}

/* CSS cho phần đánh giá và phản hồi */
.border-start {
    border-left: 3px solid #0d6efd !important;
}

.ps-3 {
    padding-left: 1rem !important;
}

.review-reply {
    background-color: #f8f9fa;
    border-radius: 0.5rem;
    margin-bottom: 0.5rem;
}

.fa-star {
    color: #ffc107;
}

.fa-star-o {
    color: #e0e0e0;
}

/* Modal phản hồi */
.modal-content {
    border-radius: 0.75rem;
    border: none;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.modal-header {
    border-bottom: 1px solid #f0f0f0;
    background-color: #f8f9fa;
    border-radius: 0.75rem 0.75rem 0 0;
}

.modal-footer {
    border-top: 1px solid #f0f0f0;
    background-color: #f8f9fa;
    border-radius: 0 0 0.75rem 0.75rem;
}
</style>