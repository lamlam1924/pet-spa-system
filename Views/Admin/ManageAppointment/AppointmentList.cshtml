@model List<pet_spa_system1.Models.Appointment>

@functions{
    public string GetStatusColor(int statusId)
    {
        switch(statusId)
        {
            case 1: return "warning text-dark";   // Chờ xác nhận
            case 2: return "success";             // Đã xác nhận
            case 3: return "secondary";           // Đã hoàn thành
            case 4: return "danger";              // Đã hủy
            default: return "light";
        }
    }
}


@{
    ViewData["Title"] = "Danh sách lịch hẹn";
    Layout = "~/Views/Admin/_LayoutAdmin.cshtml";
}

<div class="container-fluid py-4">
    <div class="d-flex mb-3 align-items-center justify-content-between">
        <h3 class="mb-0">Danh sách lịch hẹn</h3>
        <a href="@Url.Action("AppointmentCreate", "Admin")" class="btn btn-primary">
            <i class="fas fa-plus"></i> Tạo lịch mới
        </a>
    </div>

    <div class="card shadow">
        <div class="card-body p-0">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                <tr>
                    <th>ID</th>
                    <th>Khách hàng</th>
                    <th>Thú cưng</th>
                    <th>Dịch vụ</th>
                    <th>Thời gian</th>
                    <th>Trạng thái</th>
                    <th>Nhân viên</th>
                    <th>Thao tác</th>
                </tr>
                </thead>
                <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>@item.AppointmentId</td>
                        <td>@item.User?.FullName</td>
                        <td>  
                            @foreach (var pet in item.AppointmentPets)
                            {
                                @pet.Pet.Name<br />
                            }
                        </td>
                        <td>  
                            @foreach (var service in item.AppointmentServices)
                            {
                                @service.Service.Name<br />
                            }
                        </td>

                        <td>@item.AppointmentDate.ToString("dd/MM/yyyy HH:mm")</td>
                        <td>
                            <span class="badge bg-@GetStatusColor(item.StatusId)" style="color: white">
                                @item.Status.StatusName
                            </span>

                        </td>
                        <td>@(item.Employee?.FullName ?? "(Chưa phân công)")</td>
                        <td>
                            <a href="@Url.Action("AppointmentDetail", "Admin", new { id = item.AppointmentId })" class="btn btn-sm btn-info"><i class="fas fa-eye"></i></a>
                            <a href="@Url.Action("AppointmentEdit", "Admin", new { id = item.AppointmentId })" class="btn btn-sm btn-primary"><i class="fas fa-edit"></i></a>
                            <a href="@Url.Action("DeleteAppointment", "Admin", new { id = item.AppointmentId })" class="btn btn-sm btn-danger"><i class="fas fa-trash"></i></a>
                        </td>
                    </tr>
                }
                </tbody>

            </table>
        </div>
    </div>
</div>
