@model pet_spa_system1.ViewModel.AppointmentHistoryViewModel
@{
    ViewData["Title"] = "Lịch sử đặt lịch";
    Layout = "~/Views/Shared/_Layout.cshtml";
}



<!-- CSS -->
<link rel="stylesheet" href="~/cssjsAppointment/css/appointment-common.css" />
<link rel="stylesheet" href="~/cssjsAppointment/css/appointment-history.css" />
<link rel="stylesheet" href="~/cssjsAppointment/css/toast-custom.css" />
<style>
    .modal-content {
        top: 75px;
    }

    /* Appointment Detail Modal Styles */
    .appointment-detail-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 20px;
        color: white;
        border-radius: 0;
    }

    .appointment-info-card {
        background: #f8f9fa;
        border-left: 4px solid #007bff;
        padding: 15px;
        margin-bottom: 20px;
    }

    .pet-service-section {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 20px;
        overflow: hidden;
    }

    .pet-header {
        background: linear-gradient(45deg, #28a745, #20c997);
        color: white;
        padding: 15px 20px;
        font-weight: 600;
    }

    .service-timeline {
        padding: 20px;
    }

    .service-item {
        border-left: 3px solid #dee2e6;
        padding-left: 20px;
        margin-bottom: 25px;
        position: relative;
    }

    .service-item::before {
        content: '';
        position: absolute;
        left: -8px;
        top: 5px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: #dee2e6;
    }

    .service-item.completed::before {
        background: #28a745;
    }

    .service-item.in-progress::before {
        background: #ffc107;
    }

    .service-item.pending::before {
        background: #6c757d;
    }

    .service-item.cancelled::before {
        background: #dc3545;
    }

    .service-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 10px;
    }

    .service-name {
        font-weight: 600;
        color: #2c3e50;
        margin: 0;
    }

    .service-status {
        font-size: 0.85em;
    }

    .service-meta {
        color: #6c757d;
        font-size: 0.9em;
        margin-bottom: 15px;
    }

    .image-gallery {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .image-section {
        flex: 1;
        min-width: 200px;
    }

    .image-section h6 {
        color: #495057;
        font-size: 0.9em;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .image-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
        gap: 8px;
    }

    .service-image {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
        border: 2px solid #e9ecef;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .service-image:hover {
        transform: scale(1.05);
        border-color: #007bff;
        box-shadow: 0 4px 12px rgba(0,123,255,0.3);
    }

    .no-images {
        color: #adb5bd;
        font-style: italic;
        text-align: center;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 6px;
        border: 2px dashed #dee2e6;
    }

    .staff-info {
        background: #e3f2fd;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 0.9em;
        margin-bottom: 10px;
    }

    .price-info {
        background: #fff3e0;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 0.9em;
        color: #e65100;
        font-weight: 600;
    }

    /* Status badges */
    .status-completed { background-color: #d4edda !important; color: #155724 !important; }
    .status-in-progress { background-color: #fff3cd !important; color: #856404 !important; }
    .status-pending { background-color: #e2e3e5 !important; color: #383d41 !important; }
    .status-cancelled { background-color: #f8d7da !important; color: #721c24 !important; }

    /* Responsive */
  
</style>
<section class="history-section">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="page-header">
                    <h2>Lịch sử đặt lịch</h2>
                    <p>Xem thông tin chi tiết về các lịch hẹn bạn đã đặt tại pet spa của chúng tôi.</p>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="filter-section timeline-controls">
                    <div class="search-sort-container">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Tìm theo dịch vụ, thú cưng, ghi chú...">
                        </div>
                        <div class="sort-options">
                            <span class="sort-label">Sắp xếp:</span>
                            <select class="sort-select">
                                <option value="newest">Mới nhất</option>
                                <option value="oldest">Cũ nhất</option>
                            </select>
                        </div>
                    </div>
                    <div class="filter-options">
                        <span class="filter-label me-2">Lọc theo trạng thái:</span>
                        @functions {
                            public string GetFilterBadgeClass(string id)
                            {
                                switch (id)
                                {
                                    case "1": return "filter-badge-pending";
                                    case "2": return "filter-badge-confirmed";
                                    case "3": return "filter-badge-inprogress";
                                    case "4": return "filter-badge-completed";
                                    case "5": return "filter-badge-cancelled";
                                    case "6": return "filter-badge-pendingcancel";
                                    case "all": return "filter-badge-all";
                                    default: return "";
                                }
                            }
                        }
                        @foreach (var status in new[] {
                                                new { Id = "all", Icon = "fa-th-large", Name = "Tất cả" },
                                                new { Id = "1", Icon = "fa-clock", Name = "Chờ xác nhận" },
                                                new { Id = "2", Icon = "fa-calendar-check", Name = "Đã xác nhận" },
                                                new { Id = "3", Icon = "fa-play-circle", Name = "Đang thực hiện" },
                                                new { Id = "4", Icon = "fa-check-circle", Name = "Hoàn thành" },
                                                new { Id = "6", Icon = "fa-hourglass-half", Name = "Chờ duyệt hủy" },
                                                new { Id = "5", Icon = "fa-times-circle", Name = "Đã hủy" }
                                                })
                        {
                            <div class="filter-badge @GetFilterBadgeClass(status.Id) @(status.Id == "all" ? "active" : "")" data-status="@status.Id">
                                <i class="fas @status.Icon"></i> @status.Name
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="history-timeline"></div>
            </div>
        </div>

        <!-- Phân trang -->
        <div class="row">
            <div class="col-12">
                <div class="timeline-pagination">
                    <ul class="pagination">
                        <li class="page-item disabled">
                            <a class="page-link" aria-label="Previous">
                                <i class="fas fa-chevron-left"></i>
                            </a>
                        </li>
                        <li class="page-item active"><a class="page-link">1</a></li>
                        <li class="page-item"><a class="page-link">2</a></li>
                        <li class="page-item"><a class="page-link">3</a></li>
                        <li class="page-item">
                            <a class="page-link" aria-label="Next">
                                <i class="fas fa-chevron-right"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Modal Đánh giá -->
<div class="modal fade modal-review" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reviewModalLabel">Đánh giá dịch vụ</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="reviewForm">
                    <div class="mb-3">
                        <label class="form-label">Mức độ hài lòng của bạn</label>
                        <div class="star-rating">
                            <input type="radio" id="star5" name="rating" value="5">
                            <label for="star5" title="5 sao"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star4" name="rating" value="4">
                            <label for="star4" title="4 sao"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star3" name="rating" value="3">
                            <label for="star3" title="3 sao"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star2" name="rating" value="2">
                            <label for="star2" title="2 sao"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star1" name="rating" value="1">
                            <label for="star1" title="1 sao"><i class="fas fa-star"></i></label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="reviewComment" class="form-label">Nhận xét của bạn</label>
                        <textarea class="form-control" id="reviewComment" rows="3" placeholder="Chia sẻ trải nghiệm của bạn..."></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Thêm hình ảnh (tùy chọn)</label>
                        <div class="review-photo-upload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Kéo thả hoặc bấm để chọn ảnh</p>
                            <input type="file" id="reviewPhotos" multiple accept="image/*" style="display: none;">
                        </div>
                        <div class="review-photo-preview"></div>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Gửi đánh giá</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@* <!-- Modal Chi tiết lịch hẹn -->
<div class="modal fade" id="appointmentDetailModal" tabindex="-1" aria-labelledby="appointmentDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="appointmentDetailModalLabel">Chi tiết dịch vụ trong lịch hẹn</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="appointmentDetailContent">
                    <!-- Nội dung chi tiết sẽ được render bằng JS -->
                    
                    <h6>Dịch vụ đã chọn</h6>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <b>Tắm gội</b><br/>
                                            <span class="badge status-completed">Hoàn thành</span>
                                        </div>
                                        <div class="text-end">
                                            <span class="text-muted">Nhân viên: Nguyễn Văn B</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Thêm các dịch vụ khác tương tự -->
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
</div> *@
<div class="modal fade" id="appointmentDetailModal" tabindex="-1" aria-labelledby="appointmentDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-gradient-primary text-white">
                <h5 class="modal-title" id="appointmentDetailModalLabel">
                    <i class="fas fa-calendar-check me-2"></i>Chi tiết lịch hẹn
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-0">
                <div id="appointmentDetailContent">
                    <!-- Content will be loaded here -->
                    <!-- Content will be dynamically loaded -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Script -->
<script src="~/cssjsAppointment/js/appointment-history.js"></script>
<script>
        // Khi modal đóng thì bỏ focus khỏi nút hoặc phần tử đang giữ focus
        $('#appointmentDetailModal').on('hidden.bs.modal', function () {
        document.activeElement.blur();
    });


    // Truyền dữ liệu lịch hẹn sang JS
    window.appointmentData = @Html.Raw(Json.Serialize(Model.Appointments));
</script>