@model pet_spa_system1.ViewModels.AppointmentHistoryViewModel
@{
    ViewData["Title"] = "Lịch sử đặt lịch";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Debug info -->
@if (Model != null)
{
    <div style="display:none;">
        <h4>Debug Info</h4>
        <p>Appointments count: @(Model.Appointments?.Count ?? 0)</p>
        <p>Statuses count: @(Model.Statuses?.Count ?? 0)</p>
    </div>
}

<!-- CSS -->
<link rel="stylesheet" href="~/cssjsAppointment/appointment-history.css" />

<section class="history-section">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="page-header">
                    <h2>Lịch sử đặt lịch</h2>
                    <p>Xem thông tin chi tiết về các lịch hẹn bạn đã đặt tại pet spa của chúng tôi.</p>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="filter-section timeline-controls">
                    <!-- Tìm kiếm -->
                    <div class="search-sort-container">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" placeholder="Tìm theo dịch vụ, thú cưng, ghi chú...">
                        </div>
                        <div class="sort-options">
                            <span class="sort-label">Sắp xếp:</span>
                            <select class="sort-select">
                                <option value="newest">Mới nhất</option>
                                <option value="oldest">Cũ nhất</option>
                                <option value="status">Trạng thái</option>
                            </select>
                        </div>
                    </div>

                    <!-- Lọc trạng thái -->
                    <div class="filter-options">
                        <span class="filter-label me-2">Lọc theo trạng thái:</span>
                        <div class="filter-badge filter-badge-all active" data-status="all">
                            <i class="fas fa-th-large"></i> Tất cả
                        </div>
                        <div class="filter-badge filter-badge-pending" data-status="1">
                            <i class="fas fa-clock"></i> Chờ xác nhận
                        </div>
                        <div class="filter-badge filter-badge-confirmed" data-status="2">
                            <i class="fas fa-calendar-check"></i> Đã xác nhận
                        </div>
                        <div class="filter-badge filter-badge-completed" data-status="3">
                            <i class="fas fa-check-circle"></i> Hoàn thành
                        </div>
                        <div class="filter-badge filter-badge-cancelled" data-status="4">
                            <i class="fas fa-times-circle"></i> Đã hủy
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <!-- Timeline nhóm theo thời gian -->
                <div class="history-timeline">
                    @if (Model.Appointments == null || Model.Appointments.Count == 0)
                    {
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <i class="far fa-calendar-alt"></i>
                            </div>
                            <h3>Chưa có lịch hẹn nào</h3>
                            <p>Bạn chưa đặt lịch hẹn nào tại pet spa của chúng tôi. Hãy đặt lịch ngay để chăm sóc thú cưng của bạn.</p>
                            <a href="@Url.Action("Index", "Service")" class="btn btn-primary">Đặt lịch ngay</a>
                        </div>
                    }
                    else
                    {
                        <!-- Timeline được render từ JavaScript -->
                        <!-- Sẽ được điền từ dữ liệu JSON thông qua JavaScript -->
                    }
                </div>
            </div>
        </div>

        <!-- Phân trang -->
        <div class="row">
            <div class="col-12">
                <div class="timeline-pagination">
                    <ul class="pagination">
                        <li class="page-item disabled">
                            <a class="page-link" aria-label="Previous">
                                <i class="fas fa-chevron-left"></i>
                            </a>
                        </li>
                        <li class="page-item active"><a class="page-link">1</a></li>
                        <li class="page-item"><a class="page-link">2</a></li>
                        <li class="page-item"><a class="page-link">3</a></li>
                        <li class="page-item">
                            <a class="page-link" aria-label="Next">
                                <i class="fas fa-chevron-right"></i>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Modal Đánh giá -->
<div class="modal fade modal-review" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reviewModalLabel">Đánh giá dịch vụ</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="reviewForm">
                    <div class="mb-3">
                        <label class="form-label">Mức độ hài lòng của bạn</label>
                        <div class="star-rating">
                            <input type="radio" id="star5" name="rating" value="5">
                            <label for="star5" title="5 sao"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star4" name="rating" value="4">
                            <label for="star4" title="4 sao"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star3" name="rating" value="3">
                            <label for="star3" title="3 sao"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star2" name="rating" value="2">
                            <label for="star2" title="2 sao"><i class="fas fa-star"></i></label>
                            <input type="radio" id="star1" name="rating" value="1">
                            <label for="star1" title="1 sao"><i class="fas fa-star"></i></label>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="reviewComment" class="form-label">Nhận xét của bạn</label>
                        <textarea class="form-control" id="reviewComment" rows="3" placeholder="Chia sẻ trải nghiệm của bạn..."></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Thêm hình ảnh (tùy chọn)</label>
                        <div class="review-photo-upload">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Kéo thả hoặc bấm để chọn ảnh</p>
                            <input type="file" id="reviewPhotos" multiple accept="image/*" style="display: none;">
                        </div>
                        <div class="review-photo-preview"></div>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Gửi đánh giá</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Script -->
<script src="~/cssjsAppointment/appointment-history-grouped.js"></script>
<script>
    // Chuyển dữ liệu từ Model sang JavaScript
    document.addEventListener('DOMContentLoaded', function() {
        const appointmentData = @Html.Raw(Json.Serialize(Model.Appointments));
        window.appointmentData = appointmentData;
        console.log("Data loaded to window.appointmentData:", appointmentData);
        
        // Thêm debug cho phần hiển thị
        setTimeout(() => {
            console.log("Timeline container:", document.querySelector('.history-timeline'));
            console.log("Current appointments rendered:", document.querySelectorAll('.appointment-card').length);
        }, 1000);
    });
</script>
