@model pet_spa_system1.ViewModel.ProductDetailViewModel

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Chi Tiết</title>

    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Free HTML Templates" name="keywords">
    <meta content="Free HTML Templates" name="description">

    <!-- Favicon -->
    <link href="@Url.Content("img /favicon.ico")" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="@Url.Content("~/lib/owlcarousel/assets/owl.carousel.min.css")" rel="stylesheet">
    <!--------------------------------------------------->
    <link rel="shortcut icon" type="image/x-icon" href="@Url.Content("~/img/Picture5.png")">

    <link rel="stylesheet" href="@Url.Content("~/css/style.css")">
    <link rel="stylesheet" href="@Url.Content("~/css/bootstrap.min.css")">
    <link rel="stylesheet" href="@Url.Content("~/css/owl.carousel.min.css")">
    <link rel="stylesheet" href="@Url.Content("~/css/magnific-popup.css")">
    <link rel="stylesheet" href="@Url.Content("~/css/font-awesome.min.css")">
    <link rel="stylesheet" href="@Url.Content("~/css/themify-icons.css")">
    <link rel="stylesheet" href="@Url.Content("~/css/nice-select.css")">
    <link rel="stylesheet" href="@Url.Content("~/css/flaticon.css")">
    <link rel="stylesheet" href="@Url.Content("~/css/gijgo.css")">
    <link rel="stylesheet" href="@Url.Content("~/css/animate.css")">
    <link rel="stylesheet" href="@Url.Content("~/css/slicknav.css")">
    <script src="@Url.Content("~/js/includeHeader.js")"></script>

    <!-- Customized Bootstrap Stylesheet -->
    <link href="@Url.Content("~/cssProducts/style.css")" rel="stylesheet">


</head>

<body>

    <!-- Page Header Start -->
    <div class="bradcam_area breadcam_bg">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="bradcam_text text-center">
                        <h3>Chi Tiết Sản Phẩm</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Page Header End -->
    <!-- Shop Detail Start -->
    <div class="container-fluid py-5">
        <div class="row px-xl-5">
            <div class="col-lg-5 pb-5">
                <div id="product-carousel" class="carousel slide" data-ride="carousel">
                    <div class="carousel-inner border">
                        <div class="carousel-item active">
                            <img class="w-100 h-100" src="@(string.IsNullOrEmpty(Model.ProductWithRating.ImageUrl) ? "~/imgProducts/default.png" : Model.ProductWithRating.ImageUrl)" alt="Image">
                        </div>
                        <div class="carousel-item">
                            <img class="w-100 h-100" src="@(string.IsNullOrEmpty(Model.ProductWithRating.ImageUrl) ? "~/imgProducts/default.png" : Model.ProductWithRating.ImageUrl)" alt="Image">
                        </div>
                        <div class="carousel-item">
                            <img class="w-100 h-100" src="@(string.IsNullOrEmpty(Model.ProductWithRating.ImageUrl) ? "~/imgProducts/default.png" : Model.ProductWithRating.ImageUrl)" alt="Image">
                        </div>

                    </div>
                    <a class="carousel-control-prev" href="#product-carousel" data-slide="prev">
                        <i class="fa fa-2x fa-angle-left text-dark"></i>
                    </a>
                    <a class="carousel-control-next" href="#product-carousel" data-slide="next">
                        <i class="fa fa-2x fa-angle-right text-dark"></i>
                    </a>
                </div>
            </div>

            <div class="col-lg-7 pb-5">
                <h5 class="text-muted mb-2">@Model.ProductWithRating.CategoryName</h5>
                <h2 class="font-weight-bold mb-3">@Model.ProductWithRating.Name</h2>
                <div class="d-flex align-items-center mb-3">
                    <div class="text-warning mr-2">
                        @{
                            int fullStars = Model.ProductWithRating.AverageRating;
                            int emptyStars = 5 - fullStars;
                        }
                        @for (int i = 0; i < fullStars; i++)
                        {
                            <small class="fas fa-star"></small>
                        }
                        @for (int i = 0; i < emptyStars; i++)
                        {
                            <small class="far fa-star"></small>
                        }
                    </div>
                    <small class="pt-1 text-secondary" style="color : #6c757d !important">(@Model.ProductWithRating.ReviewCount Đánh Giá)</small>
                </div>
                <h3 class="font-weight-bold text-danger mb-4">@Model.ProductWithRating.Price.ToString("N0") đ</h3>
               
                <div class="d-flex align-items-center mb-4 pt-2">
                    <div class="input-group quantity mr-3" style="width: 130px;">
                        <div class="input-group-btn">
                            <button class="btn btn-primary btn-minus">
                                <i class="fa fa-minus"></i>
                            </button>
                        </div>
                        <input type="text" class="form-control bg-secondary text-center" value="1">
                        <div class="input-group-btn">
                            <button class="btn btn-primary btn-plus">
                                <i class="fa fa-plus"></i>
                            </button>
                        </div>
                    </div>
                    <form method="post" asp-controller="Cart" asp-action="AddToCart" class="d-inline">
                        <input type="hidden" name="id" value="@Model.ProductWithRating.ProductId" />
                        <button type="button" class="btn btn-sm text-dark p-0 add-to-cart-btn" data-product-id="@Model.ProductWithRating.ProductId">
                            <span class="product-icon"><i class="fas fa-shopping-cart text-primary mr-1"></i></span>Thêm vào Giỏ hàng
                        </button>
                    </form>
                </div>
                <div class="d-flex pt-2">
                    <p class="text-dark font-weight-medium mb-0 mr-2">Share on:</p>
                    <div class="d-inline-flex">
                        <a class="text-dark px-2" href="">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="row px-xl-5">
            <div class="col">
                <div class="nav nav-tabs justify-content-center border-secondary mb-4">
                    <a class="nav-item nav-link active" data-toggle="tab" href="#tab-pane-1">Mô tả</a>
                    @* <a class="nav-item nav-link" data-toggle="tab" href="#tab-pane-2">Thông tin</a> *@
                    <a class="nav-item nav-link" data-toggle="tab" href="#tab-pane-3">Đánh giá (@Model.ProductWithRating.ReviewCount) </a>
                </div>
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="tab-pane-1">
                        <h4 class="mb-3">Mô tả sản phẩm</h4>
                        <p> @(Model.ProductWithRating.Name ?? "No description available.")</p>
                    </div>
                    @* <div class="tab-pane fade" id="tab-pane-2">
                        <h4 class="mb-3">Thông tin bổ sung</h4>
                        <p>Eos no lorem eirmod diam diam, eos elitr et gubergren diam sea. Consetetur vero aliquyam invidunt duo dolores et duo sit. Vero diam ea vero et dolore rebum, dolor rebum eirmod consetetur invidunt sed sed et, lorem duo et eos elitr, sadipscing kasd ipsum rebum diam. Dolore diam stet rebum sed tempor kasd eirmod. Takimata kasd ipsum accusam sadipscing, eos dolores sit no ut diam consetetur duo justo est, sit sanctus diam tempor aliquyam eirmod nonumy rebum dolor accusam, ipsum kasd eos consetetur at sit rebum, diam kasd invidunt tempor lorem, ipsum lorem elitr sanctus eirmod takimata dolor ea invidunt.</p>
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item px-0">
                                        Sit erat duo lorem duo ea consetetur, et eirmod takimata.
                                    </li>
                                    <li class="list-group-item px-0">
                                        Amet kasd gubergren sit sanctus et lorem eos sadipscing at.
                                    </li>
                                    <li class="list-group-item px-0">
                                        Duo amet accusam eirmod nonumy stet et et stet eirmod.
                                    </li>
                                    <li class="list-group-item px-0">
                                        Takimata ea clita labore amet ipsum erat justo voluptua. Nonumy.
                                    </li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item px-0">
                                        Sit erat duo lorem duo ea consetetur, et eirmod takimata.
                                    </li>
                                    <li class="list-group-item px-0">
                                        Amet kasd gubergren sit sanctus et lorem eos sadipscing at.
                                    </li>
                                    <li class="list-group-item px-0">
                                        Duo amet accusam eirmod nonumy stet et et stet eirmod.
                                    </li>
                                    <li class="list-group-item px-0">
                                        Takimata ea clita labore amet ipsum erat justo voluptua. Nonumy.
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div> *@
                    <div class="tab-pane fade" id="tab-pane-3">
                        <div class="row">
                            <div class="col-md-6">
                                <h4 class="mb-4">@Model.ProductWithRating.ReviewCount đánh giá cho "@Model.ProductWithRating.Name"</h4>
                                @{
                                    var viewData = new ViewDataDictionary(ViewContext.ViewData);
                                    viewData["ProductId"] = Model.ProductWithRating.ProductId;
                                    viewData["ReviewPage"] = ViewBag.ReviewPage;
                                    viewData["TotalReviewPages"] = ViewBag.TotalReviewPages;
                                }
                                <div id="product-reviews">
                                    @Html.Partial("_ProductReviewsPartial", Model.ProductWithRating.Reviews, viewData)
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h4 class="mb-4">Để lại đánh giá</h4>
                                <small>Địa chỉ email của bạn sẽ không được công bố. Các trường bắt buộc được đánh dấu *</small>
                                <form id="reviewForm" method="post" action="@Url.Action("AddReview", "Products")">
                                    <input type="hidden" name="productId" value="@Model.ProductWithRating.ProductId" />
                                    <div class="form-group">
                                        <label for="rating">Đánh giá của bạn *</label>
                                        <div id="star-rating" class="mb-2">
                                            @for (int i = 1; i <= 5; i++)
                                            {
                                                <i class="far fa-star star-select" data-value="@i"></i>
                                            }
                                        </div>
                                        <input type="hidden" id="rating" name="rating" value="0" />
                                    </div>
                                    <div class="form-group">
                                        <label for="message">Nhận xét của bạn *</label>
                                        <textarea id="message" name="comment" cols="30" rows="5" class="form-control" required></textarea>
                                    </div>
                                    <div class="form-group mb-0">
                                        <input type="submit" value="Gửi đánh giá của bạn" class="btn btn-primary px-3">
                                    </div>
                                </form>
                                <script>
                                    $(function () {
                                        $(".star-select").on("click", function () {
                                            var val = $(this).data("value");
                                            $("#rating").val(val);
                                            $(".star-select").each(function (i) {
                                                if (i < val) {
                                                    $(this).removeClass("far").addClass("fas");
                                                } else {
                                                    $(this).removeClass("fas").addClass("far");
                                                }
                                            });
                                        });
                                        // AJAX submit review
                                        $('#reviewForm').on('submit', function (e) {
                                            e.preventDefault();
                                            var form = $(this);
                                            $.ajax({
                                                url: form.attr('action'),
                                                type: 'POST',
                                                data: form.serialize(),
                                                success: function (response) {
                                                    if (typeof response === 'object' && response.success === false) {
                                                        Swal.fire({
                                                            icon: 'error',
                                                            title: 'Lỗi',
                                                            text: response.message
                                                        });
                                                        return;
                                                    }
                                                    // Nếu trả về partial view, thay thế phần review
                                                    if (typeof response === 'string') {
                                                        $('#product-reviews').html(response);
                                                        Swal.fire({
                                                            icon: 'success',
                                                            title: 'Thành công',
                                                            text: 'Đánh giá của bạn đã được gửi!'
                                                        });
                                                        form[0].reset();
                                                        $(".star-select").removeClass("fas").addClass("far");
                                                    }
                                                },
                                                error: function (xhr) {
                                                    Swal.fire({
                                                        icon: 'error',
                                                        title: 'Lỗi',
                                                        text: 'Có lỗi xảy ra khi gửi đánh giá.'
                                                    });
                                                }
                                            });
                                        });
                                    });
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Shop Detail End -->
    <!-- Products Start -->
    <div class="container-fluid py-5">
        <div class="text-center mb-4">
            <h2 class="section-title px-5"><span class="px-2">Có Thế Bạn Cũng Muốn Xem Thêm</span></h2>
        </div>
        <div class="row px-xl-5">
            <div class="col">
                <div class="owl-carousel related-carousel">

                    @foreach (var item in Model.SuggestedProducts)
                    {

                        <div class="card product-item border-0">
                            <div class="card-header product-img position-relative overflow-hidden bg-transparent border p-0">
                                <img class="img-fluid w-100 lazyload"
                                     src="@(string.IsNullOrEmpty(item.ImageUrl) ? Url.Content("~/imgProducts/default.png") : Url.Content(item.ImageUrl))"
                                     alt="@item.Name"
                                     onerror="this.src='@(Url.Content("~/imgProducts/default.png"))';">
                            </div>
                            @* <div class="mb-2" style="align-items : center">
                                @{
                                    int suggestFullStars = item.AverageRating;
                                    int suggestEmptyStars = 5 - suggestFullStars;
                                }
                                @for (int i = 0; i < suggestFullStars; i++)
                                {
                                    <small class="fas fa-star text-warning"></small>
                                }
                                @for (int i = 0; i < suggestEmptyStars; i++)
                                {
                                    <small class="far fa-star text-warning"></small>
                                }
                            </div> *@
                            <div class="card-body border-left border-right text-center p-0 pt-4 pb-3">
                                <h6 class="text-truncate mb-3">@item.Name</h6>
                                <div class="d-flex justify-content-center">
                                    <h6>@item.Price.ToString("N0") đ</h6> <!-- Giả định Price không nullable -->
                                    <h6 class="text-muted ml-2"><del>@((item.Price * 1.2m).ToString("N0")) đ</del></h6>
                                </div>
                            </div>
                            <div class="card-footer d-flex justify-content-between bg-light border">
                                <a href="@Url.Action("Detail", "Products", new { productID = item.ProductId })" class="btn btn-sm text-dark p-0">
                                    <i class="fas fa-eye text-primary mr-1"></i>View Detail
                                </a>
                                <a href="@Url.Action("AddToCart", "Cart", new { id = item.ProductId })" class="btn btn-sm text-dark p-0">
                                    <i class="fas fa-shopping-cart text-primary mr-1"></i>Add To Cart
                                </a>
                            </div>
                        </div>
                    }

                </div>
            </div>
        </div>
    </div>
    <!-- Products End -->
    <!-- Back to Top -->
    <a href="#" class="btn btn-primary back-to-top"><i class="fa fa-angle-double-up"></i></a>


    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="@Url.Content("~/libProducts/easing/easing.min.js")"></script>
    <script src="@Url.Content("~/libProducts/owlcarousel/owl.carousel.min.js")"></script>

    <!-- Contact Javascript File -->
    <script src="@Url.Content("~/mailProducts/jqBootstrapValidation.min.js")"></script>
    <script src="@Url.Content("~/mailProducts/contact.js")"></script>

    <!-- Template Javascript -->
    <script src="@Url.Content("~/jsProducts/main.js")"></script>

    <!-- JS here -->
    <script src="@Url.Content("~/js/vendor/modernizr-3.5.0.min.js")"></script>
    <script src="@Url.Content("~/js/vendor/jquery-1.12.4.min.js")"></script>
    <script src="@Url.Content("~/js/popper.min.js")"></script>
    <script src="@Url.Content("~/js/bootstrap.min.js")"></script>
    <script src="@Url.Content("~/js/owl.carousel.min.js")"></script>
    <script src="@Url.Content("~/js/isotope.pkgd.min.js")"></script>
    <script src="@Url.Content("~/js/ajax-form.js")"></script>
    <script src="@Url.Content("~/js/waypoints.min.js")"></script>
    <script src="@Url.Content("~/js/jquery.counterup.min.js")"></script>
    <script src="@Url.Content("~/js/imagesloaded.pkgd.min.js")"></script>
    <script src="@Url.Content("~/js/scrollIt.js")"></script>
    <script src="@Url.Content("~/js/jquery.scrollUp.min.js")"></script>
    <script src="@Url.Content("~/js/wow.min.js")"></script>
    <script src="@Url.Content("~/js/nice-select.min.js")"></script>
    <script src="@Url.Content("~/js/jquery.slicknav.min.js")"></script>
    <script src="@Url.Content("~/js/jquery.magnific-popup.min.js")"></script>
    <script src="@Url.Content("~/js/plugins.js")"></script>
    <script src="@Url.Content("~/js/gijgo.min.js")"></script>

    <!--contact js-->
    <script src="@Url.Content("~/js/contact.js")"></script>
    <script src="@Url.Content("~/js/jquery.ajaxchimp.min.js")"></script>
    <script src="@Url.Content("~/js/jquery.form.js")"></script>
    <script src="@Url.Content("~/js/jquery.validate.min.js")"></script>
    <script src="@Url.Content("~/js/mail-script.js")"></script>

    <script src="@Url.Content("~/js/main.js")"></script>
    <script>
           $('#datepicker').datepicker({
               iconsLibrary: 'fontawesome',
               disableDaysOfWeek: [0, 0],
           //     icons: {
           //      rightIcon: '<span class="fa fa-caret-down"></span>'
           //  }
           });
           $('#datepicker2').datepicker({
               iconsLibrary: 'fontawesome',
               icons: {
                rightIcon: '<span class="fa fa-caret-down"></span>'
            }

           });
           var timepicker = $('#timepicker').timepicker({
            format: 'HH.MM'
        });
    </script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        /* Cải thiện giao diện review */
        .review-item {
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
            background: #fff;
            margin-bottom: 18px;
            padding: 18px 20px 10px 20px;
            transition: box-shadow 0.2s;
        }

            .review-item:hover {
                box-shadow: 0 4px 16px rgba(0,0,0,0.13);
            }

            .review-item img {
                border-radius: 50%;
                border: 2px solid #eee;
                width: 48px;
                height: 48px;
                object-fit: cover;
            }

        .review-replies {
            margin-top: 10px;
            border-left: 3px solid #f0f0f0;
            padding-left: 16px;
        }

        .pagination .page-link {
            border-radius: 6px !important;
            margin: 0 2px;
            color: #007bff;
            font-weight: 500;
        }

        .pagination .page-item.active .page-link {
            background: #007bff;
            color: #fff;
            border: none;
        }

        .pagination .page-link:hover {
            background: #e9ecef;
            color: #0056b3;
        }
    </style>
</body>

</html>